#!/bin/bash
# Wrapper for wifi-location that launches it properly via macOS LaunchServices
# This is required for Location Services authorization on macOS Sequoia

OUTPUT_FILE="/tmp/wifi-location-$$.txt"
trap "rm -f '$OUTPUT_FILE'" EXIT

# Launch app bundle via open (required for Location Services auth)
env OUTPUT_FILE="$OUTPUT_FILE" open ~/Applications/wifi-location.app

# Wait for output file (max 3 seconds)
for i in {1..30}; do
    if [ -f "$OUTPUT_FILE" ]; then
        cat "$OUTPUT_FILE"
        exit 0
    fi
    sleep 0.1
done

# Timeout - return empty result
echo "||"
exit 1
